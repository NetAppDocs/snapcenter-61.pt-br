---
permalink: protect-hana/task_back_up_sap_hana_databases.html 
sidebar: sidebar 
keywords: SnapCenter Plug-in for SAP HANA Database 
summary: Se um recurso ainda não fizer parte de nenhum grupo de recursos, você poderá fazer backup do recurso na página Recursos. 
---
= Fazer backup de bancos de dados SAP HANA
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Se um recurso ainda não fizer parte de nenhum grupo de recursos, você poderá fazer backup do recurso na página Recursos.

.Antes de começar
* Você deve ter criado uma política de backup.
* Se você quiser fazer backup de um recurso que tenha um relacionamento SnapMirror com um armazenamento secundário, a função ONTAP atribuída ao usuário do armazenamento deve incluir o privilégio "`snapmirror all`".  Entretanto, se você estiver usando a função "`vsadmin`", o privilégio "`snapmirror all`" não será necessário.
* Para a operação de backup baseada em cópia de instantâneo, certifique-se de que todos os bancos de dados de locatários sejam válidos e ativos.
* Para criar backups de replicação do sistema SAP HANA, é recomendável adicionar todos os recursos do sistema SAP HANA em um grupo de recursos.  Isso garante um backup perfeito durante o modo de failback de aquisição.
+
link:task_create_resource_groups_and_attach_policies.html["Crie grupos de recursos e anexe políticas"] .

+
link:task_back_up_resource_groups_sap_hana.html["Fazer backup de grupos de recursos"]

* Se você quiser criar um backup baseado em arquivo quando um ou mais bancos de dados de locatários estiverem inativos, defina o parâmetro ALLOW_FILE_BASED_BACKUP_IFINACTIVE_TENANTS_PRESENT como *YES* no arquivo de propriedades do HANA usando `Set-SmConfigSettings` cmdlet.
+
As informações sobre os parâmetros que podem ser usados com o cmdlet e suas descrições podem ser obtidas executando Get-Help _command_name_.  Alternativamente, você também pode consultar o https://docs.netapp.com/us-en/snapcenter-cmdlets/index.html["Guia de referência do cmdlet do software SnapCenter"]

* Para comandos pré e pós para operações de inatividade, instantâneo e retomada de atividade, você deve verificar se os comandos existem na lista de comandos disponível no host do plug-in nos seguintes caminhos:
+
** Local padrão no host do Windows: _C:\Arquivos de Programas\ NetApp\ SnapCenter\Snapcenter Plug-in Creator\etc\allowed_commands.config_
** Local padrão no host Linux: _/opt/ NetApp/snapcenter/scc/etc/allowed_commands.config_





NOTE: Se os comandos não existirem na lista de comandos, a operação falhará.

[role="tabbed-block"]
====
.Interface do usuário do SnapCenter
--
.Passos
. No painel de navegação esquerdo, selecione *Recursos* e, em seguida, selecione o plug-in apropriado na lista.
. Na página Recurso, filtre os recursos da lista suspensa *Exibir* com base no tipo de recurso.
+
Selecione *image:../media/filter_icon.gif["ícone de filtro"] * e selecione o nome do host e o tipo de recurso para filtrar os recursos.  Você pode então selecionarimage:../media/filter_icon.gif["ícone de filtro"] para fechar o painel de filtro.

. Selecione o recurso que você deseja fazer backup.
. Na página Recurso, selecione *Usar formato de nome personalizado para cópia do Snapshot* e insira um formato de nome personalizado que você deseja usar para o nome do Snapshot.
+
Por exemplo, _customtext_policy_hostname_ ou _resource_hostname_.  Por padrão, um registro de data e hora é anexado ao nome do Snapshot.

. Na página Configurações do aplicativo, faça o seguinte:
+
** Selecione a seta *Backups* para definir opções adicionais de backup:
+
Habilite o backup do grupo de consistência, se necessário, e execute as seguintes tarefas:

+
|===
| Para este campo... | Faça isso... 


 a| 
Permitir tempo para esperar a conclusão da operação "Consistency Group Snapshot"
 a| 
Selecione *Urgente*, ou *Médio*, ou *Relaxado* para especificar o tempo de espera para a operação de Snapshot terminar.  Urgente = 5 segundos, Médio = 7 segundos e Relaxado = 20 segundos.



 a| 
Desativar sincronização WAFL
 a| 
Selecione esta opção para evitar forçar um ponto de consistência WAFL .

|===
** Selecione a seta *Scripts* para executar comandos pré e pós para operações de inatividade, instantâneo e ativação/desativação.
+
Você também pode executar pré-comandos antes de sair da operação de backup.  Prescrições e pós-escritos são executados no SnapCenter Server.

** Selecione a seta **Configurações personalizadas** e insira os pares de valores personalizados necessários para todos os trabalhos que usam este recurso.
** Selecione a seta *Ferramenta de Cópia de Instantâneo* para selecionar a ferramenta para criar Instantâneos:
+
|===
| Se você quiser... | Então... 


 a| 
SnapCenter para criar um Snapshot de nível de armazenamento
 a| 
Selecione * SnapCenter sem consistência do sistema de arquivos*.



 a| 
SnapCenter para usar o plug-in para Windows para colocar o sistema de arquivos em um estado consistente e, em seguida, criar um Snapshot
 a| 
Selecione * SnapCenter com consistência do sistema de arquivos*.



 a| 
Para inserir o comando para criar um Snapshot
 a| 
Selecione *Outro* e insira o comando para criar um Snapshot.

|===
+
image:../media/application_settings.gif["configurações do aplicativo"]



. Na página Políticas, execute as seguintes etapas:
+
.. Selecione uma ou mais políticas na lista suspensa.
+

NOTE: Você também pode criar uma política clicando em *image:../media/add_policy_from_resourcegroup.gif["adicionar grupo de recursos de formulário de política"] *.

+
Na seção Configurar agendamentos para políticas selecionadas, as políticas selecionadas são listadas.

.. Selecione *image:../media/add_policy_from_resourcegroup.gif["adicionar grupo de recursos de formulário de política"] * na coluna Configurar agendamentos da política para a qual você deseja configurar um agendamento.
.. Na caixa de diálogo Adicionar agendamentos para a política _nome_da_política_, configure o agendamento e selecione *OK*.
+
_policy_name_ é o nome da política que você selecionou.

+
Os agendamentos configurados são listados na coluna Agendamentos Aplicados.



. Na página Notificação, na lista suspensa *Preferência de e-mail*, selecione os cenários nos quais você deseja enviar os e-mails.
+
Você também deve especificar os endereços de e-mail do remetente e do destinatário, e o assunto do e-mail.  O SMTP também deve ser configurado em *Configurações* > *Configurações globais*.

. Revise o resumo e selecione *Concluir*.
+
A página de topologia de recursos é exibida.

. Selecione *Fazer backup agora*.
. Na página Backup, execute as seguintes etapas:
+
.. Se você aplicou várias políticas ao recurso, na lista suspensa *Política*, selecione a política que deseja usar para backup.
+
Se a política selecionada para o backup sob demanda estiver associada a um agendamento de backup, os backups sob demanda serão retidos com base nas configurações de retenção especificadas para o tipo de agendamento.

.. Selecione *Backup*.


. Monitore o progresso da operação clicando em *Monitorar* > *Trabalhos*.
+
** Nas configurações do MetroCluster , o SnapCenter pode não conseguir detectar um relacionamento de proteção após um failover.
+
Para mais informações, consulte: https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Unable_to_detect_SnapMirror_or_SnapVault_relationship_after_MetroCluster_failover["Não é possível detectar o relacionamento SnapMirror ou SnapVault após failover do MetroCluster"^]

** Se você estiver fazendo backup de dados do aplicativo em VMDKs e o tamanho do heap Java para o SnapCenter Plug-in for VMware vSphere não for grande o suficiente, o backup poderá falhar.
+
Para aumentar o tamanho do heap Java, localize o arquivo de script _/opt/netapp/init_scripts/scvservice_.  Nesse script, o comando _do_start method_ inicia o serviço de plug-in SnapCenter VMware.  Atualize esse comando para o seguinte: _Java -jar -Xmx8192M -Xms4096M_





--
.Cmdlets do PowerShell
--
.Passos
. Inicie uma sessão de conexão com o SnapCenter Server para um usuário especificado usando o cmdlet Open-SmConnection.
+
[listing]
----
Open-smconnection  -SMSbaseurl  https:\\snapctr.demo.netapp.com:8146\
----
+
O prompt de nome de usuário e senha é exibido.

. Adicione recursos usando o cmdlet Add-SmResources.
+
Este exemplo mostra como adicionar um banco de dados SAP HANA do tipo SingleContainer:

+
[listing]
----
C:\PS> Add-SmResource -HostName '10.232.204.42' -PluginCode 'HANA' -DatabaseName H10 -ResourceType SingleContainer -StorageFootPrint (@{"VolumeName"="HanaData10";"StorageSystem"="vserver_scauto_primary"}) -SID 'H10' -filebackuppath '/tmp/HanaFileLog' -userstorekeys 'HS10' -osdbuser 'h10adm' -filebackupprefix 'H10_'
----
+
Este exemplo mostra como adicionar um banco de dados SAP HANA do tipo MultipleContainers:

+
[listing]
----
C:\PS> Add-SmResource -HostName 'vp-hana2.gdl.englab.netapp.com' -PluginCode 'HANA' -DatabaseName MDC_MT -ResourceType MultipleContainers -StorageFootPrint (@{"VolumeName"="VP_HANA2_data";"StorageSystem"="buck.gdl.englab.netapp.com"}) -sid 'A12' -userstorekeys 'A12KEY' -TenantType 'MultiTenant'
----
+
Este exemplo mostra como criar um recurso de volume não relacionado a dados:

+
[listing]
----
C:\PS> Add-SmResource -HostName 'SNAPCENTERN42.sccore.test.com' -PluginCode 'hana' -ResourceName NonDataVolume -ResourceType NonDataVolume -StorageFootPrint (@{"VolumeName"="ng_pvol";"StorageSystem"="vserver_scauto_primary"}) -sid 'S10'
----
. Crie uma política de backup usando o cmdlet Add-SmPolicy.
+
Este exemplo cria uma política de backup para um backup baseado em cópia de instantâneo:

+
[listing]
----
C:\PS> Add-SmPolicy -PolicyName hana_snapshotbased -PolicyType Backup -PluginPolicyType hana -BackupType SnapShotBasedBackup
----
+
Este exemplo cria uma política de backup para um backup baseado em arquivo:

+
[listing]
----
C:\PS> Add-SmPolicy -PolicyName hana_Filebased -PolicyType Backup -PluginPolicyType hana -BackupType FileBasedBackup
----
. Proteja o recurso ou adicione um novo grupo de recursos ao SnapCenter usando o cmdlet Add-SmResourceGroup.
+
Este exemplo protege um único recurso de contêiner:

+
[listing]
----
C:\PS> Add-SmProtectResource -PluginCode HANA  -Policies hana_snapshotbased,hana_Filebased
 -Resources @{"Host"="host.example.com";"UID"="SID"} -Description test -usesnapcenterwithoutfilesystemconsistency
----
+
Este exemplo protege um recurso de vários contêineres:

+
[listing]
----
C:\PS> Add-SmProtectResource -PluginCode HANA  -Policies hana_snapshotbased,hana_Filebased
 -Resources @{"Host"="host.example.com";"UID"="MDC\SID"} -Description test -usesnapcenterwithoutfilesystemconsistency
----
+
Este exemplo cria um novo grupo de recursos com a política e os recursos especificados:

+
[listing]
----
C:\PS> Add-SmResourceGroup -ResourceGroupName 'ResourceGroup_with_SingleContainer_MultipleContainers_Resources' -Resources @(@{"Host"="sccorelinux61.sccore.test.com";"Uid"="SID"},@{"Host"="sccorelinux62.sccore.test.com";"Uid"="MDC\SID"})
  -Policies hana_snapshotbased,hana_Filebased  -usesnapcenterwithoutfilesystemconsistency  -plugincode 'HANA'
----
+
Este exemplo cria um grupo de recursos de volume sem dados:

+
[listing]
----
C:\PS> Add-SmResourceGroup -ResourceGroupName 'Mixed_RG_backup_when_Remove_Backup_throguh_BackupName_windows' -Resources @(@{"Host"="SNAPCENTERN42.sccore.test.com";"Uid"="H11";"PluginName"="hana"},@{"Host"="SNAPCENTERN42.sccore.test.com";"Uid"="MDC\H31";"PluginName"="hana"},@{"Host"="SNAPCENTERN42.sccore.test.com";"Uid"="NonDataVolume\S10\NonDataVolume";"PluginName"="hana"}) -Policies hanaprimary
----
. Inicie uma nova tarefa de backup usando o cmdlet New-SmBackup.
+
Este exemplo mostra como fazer backup de um grupo de recursos:

+
[listing]
----
C:\PS> New-SMBackup -ResourceGroupName 'ResourceGroup_with_SingleContainer_MultipleContainers_Resources'  -Policy hana_snapshotbased
----
+
Este exemplo faz backup de um recurso protegido:

+
[listing]
----
C:\PS> New-SMBackup -Resources @{"Host"="10.232.204.42";"Uid"="MDC\SID";"PluginName"="hana"} -Policy hana_Filebased
----
. Monitore o status do trabalho (em execução, concluído ou com falha) usando o cmdlet Get-smJobSummaryReport.
+
[listing]
----
PS C:\> Get-smJobSummaryReport -JobID 123
----
. Monitore os detalhes do trabalho de backup, como ID do backup, nome do backup para executar a operação de restauração ou clonagem usando o cmdlet Get-SmBackupReport.
+
[listing]
----
PS C:\> Get-SmBackupReport -JobId 351
Output:
BackedUpObjects           : {DB1}
FailedObjects             : {}
IsScheduled               : False
HasMetadata               : False
SmBackupId                : 269
SmJobId                   : 2361
StartDateTime             : 10/4/2016 11:20:45 PM
EndDateTime               : 10/4/2016 11:21:32 PM
Duration                  : 00:00:46.2536470
CreatedDateTime           : 10/4/2016 11:21:09 PM
Status                    : Completed
ProtectionGroupName       : Verify_ASUP_Message_windows
SmProtectionGroupId       : 211
PolicyName                : test2
SmPolicyId                : 20
BackupName                : Verify_ASUP_Message_windows_scc54_10-04-2016_23.20.46.2758
VerificationStatus        : NotVerified
VerificationStatuses      :
SmJobError                :
BackupType                : SCC_BACKUP
CatalogingStatus          : NotApplicable
CatalogingStatuses        :
ReportDataCreatedDateTime :
----


As informações sobre os parâmetros que podem ser usados com o cmdlet e suas descrições podem ser obtidas executando _Get-Help command_name_. Alternativamente, você também pode consultar o https://docs.netapp.com/us-en/snapcenter-cmdlets/index.html["Guia de referência do cmdlet do software SnapCenter"^] .

--
====