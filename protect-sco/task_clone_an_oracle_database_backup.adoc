---
permalink: protect-sco/task_clone_an_oracle_database_backup.html 
sidebar: sidebar 
keywords: Credentials, alternate host, clone, FRA, OMF 
summary: Você pode usar o SnapCenter para clonar um banco de dados Oracle usando o backup do banco de dados. 
---
= Clonar um backup de banco de dados Oracle
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Você pode usar o SnapCenter para clonar um banco de dados Oracle usando o backup do banco de dados.

*Antes de começar*

Se você instalou o plug-in como um usuário não root, deverá atribuir manualmente as permissões de execução aos diretórios prescript e postscript.

*Sobre esta tarefa*

* A operação de clonagem cria uma cópia dos arquivos de dados do banco de dados e cria novos arquivos de log de refazer on-line e arquivos de controle.  O banco de dados pode ser recuperado opcionalmente em um horário específico, com base nas opções de recuperação especificadas.
+

NOTE: A clonagem falhará se você tentar clonar um backup criado em um host Linux para um host AIX ou vice-versa.

+
O SnapCenter cria um banco de dados independente quando clonado de um backup de banco de dados Oracle RAC.  O SnapCenter oferece suporte à criação de clones a partir do backup de um banco de dados Data Guard standby e Active Data Guard standby.

+
Durante a clonagem, o SnapCenter monta o número ideal de backups de log com base no SCN ou data e hora para operações de recuperação.  Após a recuperação, o backup do log é desmontado.  Todos esses clones são montados em _/var/opt/snapcenter/scu/clones/_.  Se estiver usando ASM sobre NFS, você deve adicionar _/var/opt/snapcenter/scu/clones/*/*_ ao caminho existente definido no parâmetro asm_diskstring.

+
Ao clonar um backup de um banco de dados ASM em um ambiente SAN, as regras do udev para os dispositivos host clonados são criadas em _/etc/udev/rules.d/999-scu-netapp.rules_.  Essas regras do udev associadas aos dispositivos host clonados são excluídas quando você exclui o clone.

+

NOTE: Em uma configuração do Flex ASM, você não pode executar a operação de clonagem em nós Leaf se a cardinalidade for menor que o número de nós no cluster RAC.

* Para políticas habilitadas para SnapLock , para ONTAP 9.12.1 e versões anteriores, se você especificar um período de bloqueio de Snapshot, os clones criados a partir de Snapshots à prova de violação como parte da restauração herdarão o tempo de expiração do SnapLock . O administrador de armazenamento deve limpar manualmente os clones após o tempo de expiração do SnapLock .


.Passos
. No painel de navegação esquerdo, clique em *Recursos* e selecione o plug-in apropriado na lista.
. Na página Recursos, selecione *Banco de dados* ou *Grupo de recursos* na lista *Exibir*.
. Selecione o banco de dados na exibição de detalhes do banco de dados ou na exibição de detalhes do grupo de recursos.
+
A página de topologia do banco de dados é exibida.

. Na exibição Gerenciar cópias, selecione os backups entre Cópias locais (primárias), Cópias espelhadas (secundárias) ou Cópias de cofre (secundárias).
. Selecione o backup de dados na tabela e clique em *image:../media/clone_icon.gif["ícone de clone"] *.
. Na página Nome, execute uma das seguintes ações:
+
|===
| Se você quiser... | Passos... 


 a| 
Clonar um banco de dados (CDB ou não CDB)
 a| 
.. Especifique o SID do clone.
+
O SID clone não está disponível por padrão, e o comprimento máximo do SID é de 8 caracteres.

+

NOTE: Você deve garantir que não exista nenhum banco de dados com o mesmo SID no host onde o clone será criado.





 a| 
Clonar um banco de dados plugável (PDB)
 a| 
.. Selecione *PDB Clone*.
.. Especifique o PDB que você deseja clonar.
.. Especifique o nome do PDB clonado.  Para obter as etapas detalhadas para clonar um PDB, consultelink:../protect-sco/task_clone_a_pluggable_database.html["Clonar um banco de dados plugável"^] .


|===
+
Quando você seleciona dados espelhados ou de cofre:

+
** se não houver backup de log no espelho ou no cofre, nada será selecionado e os localizadores estarão vazios.
** se houver backups de log no espelho ou no cofre, o backup de log mais recente será selecionado e o localizador correspondente será exibido.
+

NOTE: Se o backup de log selecionado existir no espelho e no cofre, ambos os localizadores serão exibidos.



. Na página Locais, execute as seguintes ações:
+
|===
| Para este campo... | Faça isso... 


 a| 
Host clone
 a| 
Por padrão, o host do banco de dados de origem é preenchido.

Se você quiser criar o clone em um host alternativo, selecione o host que tenha a mesma versão do Oracle e do sistema operacional que o host do banco de dados de origem.



 a| 
Localizações de arquivos de dados
 a| 
Por padrão, o local do arquivo de dados é preenchido.

A convenção de nomenclatura padrão do SnapCenter para sistemas de arquivos SAN ou NFS é FileSystemNameofsourcedatabase_CLONESID.

A convenção de nomenclatura padrão do SnapCenter para grupos de discos ASM é SC_HASHCODEofDISKGROUP_CLONESID.  O HASHCODEofDISKGROUP é um número gerado automaticamente (2 a 10 dígitos) que é exclusivo para cada grupo de discos ASM.


NOTE: Se você estiver personalizando o nome do grupo de discos ASM, certifique-se de que o comprimento do nome esteja de acordo com o comprimento máximo suportado pela Oracle.

Se quiser especificar um caminho diferente, você deve inserir os pontos de montagem do arquivo de dados ou os nomes dos grupos de discos ASM para o banco de dados clone.  Ao personalizar o caminho do arquivo de dados, você também deve alterar os nomes dos grupos de discos ASM ou do sistema de arquivos do arquivo de controle e do arquivo de log de refazer para o mesmo nome usado para arquivos de dados ou para grupos de discos ASM ou sistema de arquivos existentes.



 a| 
Arquivos de controle
 a| 
Por padrão, o caminho do arquivo de controle é preenchido.

Os arquivos de controle são colocados no mesmo grupo de discos ASM ou sistema de arquivos dos arquivos de dados.  Se quiser substituir o caminho do arquivo de controle, você pode fornecer um caminho de arquivo de controle diferente.


NOTE: O sistema de arquivos ou o grupo de discos ASM deve existir no host.

Por padrão, o número de arquivos de controle será o mesmo do banco de dados de origem.  Você pode modificar o número de arquivos de controle, mas é necessário no mínimo um arquivo de controle para clonar o banco de dados.

Você pode personalizar o caminho do arquivo de controle para um sistema de arquivos diferente (existente) daquele do banco de dados de origem.



 a| 
Logs de refazer
 a| 
Por padrão, o grupo de arquivos de log de refazer, o caminho e seus tamanhos são preenchidos.

Os logs de refazer são colocados no mesmo grupo de discos ASM ou sistema de arquivos dos arquivos de dados do banco de dados clonado.  Se você quiser substituir o caminho do arquivo de log de refazer, poderá personalizá-lo para um sistema de arquivos diferente daquele do banco de dados de origem.


NOTE: O novo sistema de arquivos ou o grupo de discos ASM deve existir no host.

Por padrão, o número de grupos de logs de redo, arquivos de log de redo e seus tamanhos serão os mesmos do banco de dados de origem.  Você pode modificar os seguintes parâmetros:

** Número de grupos de logs de refazer



NOTE: São necessários no mínimo dois grupos de logs de refazer para clonar o banco de dados.

** Refazer arquivos de log em cada grupo e seu caminho
+
Você pode personalizar o caminho do arquivo de log de refazer para um sistema de arquivos diferente (existente) daquele do banco de dados de origem.




NOTE: É necessário no mínimo um arquivo de log de refazer no grupo de log de refazer para clonar o banco de dados.

** Tamanhos do arquivo de log de refazer


|===
. Na página Credenciais, execute as seguintes ações:
+
|===
| Para este campo... | Faça isso... 


 a| 
Nome da credencial para usuário sys
 a| 
Selecione a credencial a ser usada para definir a senha do usuário sys do banco de dados clone.

Se SQLNET.AUTHENTICATION_SERVICES estiver definido como NONE no arquivo sqlnet.ora no host de destino, você não deverá selecionar *None* como Credencial na GUI do SnapCenter .



 a| 
Nome da credencial da instância ASM
 a| 
Selecione *Nenhum* se a autenticação do sistema operacional estiver habilitada para conexão com a instância do ASM no host clone.

Caso contrário, selecione a credencial do Oracle ASM configurada com o usuário "`sys`" ou um usuário com privilégio "`sysasm`" aplicável ao host clone.

|===
+
Os detalhes do Oracle home, nome de usuário e grupo são preenchidos automaticamente a partir do banco de dados de origem.  Você pode alterar os valores com base no ambiente Oracle do host onde o clone será criado.

. Na página PreOps, execute as seguintes etapas:
+
.. Insira o caminho e os argumentos da prescrição que você deseja executar antes da operação de clonagem.
+
Você deve armazenar a prescrição em _/var/opt/snapcenter/spl/scripts_ ou em qualquer pasta dentro deste caminho.  Por padrão, o caminho _/var/opt/snapcenter/spl/scripts_ é preenchido.  Se você colocou o script em qualquer pasta dentro deste caminho, você precisa fornecer o caminho completo até a pasta onde o script está colocado.

+
O SnapCenter permite que você use as variáveis ​​de ambiente predefinidas ao executar o prescript e o postscript.link:../protect-sco/predefined-environment-variables-prescript-postscript-clone.html["Saber mais"^]

.. Na seção Configurações de parâmetros do banco de dados, modifique os valores dos parâmetros do banco de dados pré-preenchidos que são usados para inicializar o banco de dados.
+
Você pode adicionar parâmetros adicionais clicando em *image:../media/add_policy_from_resourcegroup.gif["adicionar grupo de recursos de formulário de política"] *.

+
Se você estiver usando o Oracle Standard Edition e o banco de dados estiver sendo executado no modo de log de arquivamento ou se desejar restaurar um banco de dados a partir do log de refazer do arquivo, adicione os parâmetros e especifique o caminho.

+
*** DESTINO_DE_ARQUIVO_DE_LOG
*** LOG_ARQUIVO_DUPLEX_DESTINO
+

NOTE: A área de recuperação rápida (FRA) não está definida nos parâmetros do banco de dados pré-preenchidos.  Você pode configurar o FRA adicionando os parâmetros relacionados.

+

NOTE: O valor padrão de log_archive_dest_1 é $ORACLE_HOME/clone_sid e os logs de arquivamento do banco de dados clonado serão criados neste local.  Se você excluiu o parâmetro log_archive_dest_1, o local do log de arquivamento será determinado pelo Oracle.  Você pode definir um novo local para o log de arquivamento editando log_archive_dest_1, mas certifique-se de que o sistema de arquivos ou grupo de discos exista e esteja disponível no host.



.. Clique em *Redefinir* para obter as configurações padrão dos parâmetros do banco de dados.


. Na página PostOps, *Recuperar banco de dados* e *Até cancelar* são selecionados por padrão para executar a recuperação do banco de dados clonado.
+
O SnapCenter executa a recuperação montando o backup de log mais recente que tem a sequência ininterrupta de logs de arquivamento após o backup de dados que foi selecionado para clonagem.  O backup de log e dados deve estar no armazenamento primário para executar a clonagem no armazenamento primário e o backup de log e dados deve estar no armazenamento secundário para executar a clonagem no armazenamento secundário.

+
As opções *Recuperar banco de dados* e *Até cancelar* não serão selecionadas se o SnapCenter não encontrar os backups de log apropriados.  Você pode fornecer o local do log de arquivamento externo se o backup do log não estiver disponível em *Especificar locais do log de arquivamento externo*.  Você pode especificar vários locais de log.

+

NOTE: Se você quiser clonar um banco de dados de origem configurado para oferecer suporte à área de recuperação flash (FRA) e ao Oracle Managed Files (OMF), o destino do log para recuperação também deverá aderir à estrutura de diretório do OMF.

+
A página PostOps não será exibida se o banco de dados de origem for um banco de dados standby do Data Guard ou um banco de dados standby do Data Guard ativo.  Para um banco de dados em espera do Data Guard ou um banco de dados em espera do Data Guard ativo, o SnapCenter não fornece uma opção para selecionar o tipo de recuperação na GUI do SnapCenter , mas o banco de dados é recuperado usando o tipo de recuperação Até Cancelar, sem aplicar nenhum log.

+
|===
| Nome do campo | Descrição 


 a| 
Até Cancelar
 a| 
O SnapCenter executa a recuperação montando o backup de log mais recente com a sequência ininterrupta de logs de arquivo após o backup de dados que foi selecionado para clonagem.  O banco de dados clonado é recuperado até o arquivo de log ausente ou corrompido.



 a| 
Data e hora
 a| 
O SnapCenter recupera o banco de dados até uma data e hora especificadas.  O formato aceito é mm/dd/aaaa hh:mm:ss.


NOTE: O horário pode ser especificado no formato de 24 horas.



 a| 
Até SCN (Número de Alteração do Sistema)
 a| 
O SnapCenter recupera o banco de dados até um número de alteração do sistema (SCN) especificado.



 a| 
Especificar locais de log de arquivo externo
 a| 
Se o banco de dados estiver sendo executado no modo ARCHIVELOG, o SnapCenter identificará e montará o número ideal de backups de log com base no SCN especificado ou na data e hora selecionadas.

Você também pode especificar o local do log de arquivamento externo.


NOTE: O SnapCenter não identificará nem montará automaticamente os backups de log se você tiver selecionado Até cancelar.



 a| 
Criar novo DBID
 a| 
Por padrão, a caixa de seleção *Criar novo DBID* é selecionada para gerar um número exclusivo (DBID) para o banco de dados clonado, diferenciando-o do banco de dados de origem.

Desmarque a caixa de seleção se quiser atribuir o DBID do banco de dados de origem ao banco de dados clonado.  Nesse cenário, se você quiser registrar o banco de dados clonado no catálogo RMAN externo onde o banco de dados de origem já está registrado, a operação falhará.



 a| 
Criar arquivo temporário para espaço de tabela temporário
 a| 
Marque a caixa de seleção se desejar criar um arquivo temporário para o tablespace temporário padrão do banco de dados clonado.

Se a caixa de seleção não estiver marcada, o clone do banco de dados será criado sem o arquivo temporário.



 a| 
Insira entradas SQL para aplicar quando o clone for criado
 a| 
Adicione as entradas SQL que você deseja aplicar quando o clone for criado.



 a| 
Insira scripts para executar após a operação de clonagem
 a| 
Especifique o caminho e os argumentos do postscript que você deseja executar após a operação de clonagem.

Você deve armazenar o postscript em _/var/opt/snapcenter/spl/scripts_ ou em qualquer pasta dentro deste caminho.  Por padrão, o caminho _/var/opt/snapcenter/spl/scripts_ é preenchido.

Se você colocou o script em qualquer pasta dentro deste caminho, você precisa fornecer o caminho completo até a pasta onde o script está colocado.


NOTE: Se a operação de clonagem falhar, os postscripts não serão executados e as atividades de limpeza serão acionadas diretamente.

|===
. Na página Notificação, na lista suspensa *Preferência de e-mail*, selecione os cenários nos quais você deseja enviar os e-mails.
+
Você também deve especificar os endereços de e-mail do remetente e do destinatário, e o assunto do e-mail.  Se você quiser anexar o relatório da operação de clonagem realizada, selecione *Anexar relatório de trabalho*.

+

NOTE: Para notificação por e-mail, você deve ter especificado os detalhes do servidor SMTP usando a GUI ou o comando Set-SmSmtpServer do PowerShell.

. Revise o resumo e clique em *Concluir*.
+

NOTE: Ao executar a recuperação como parte da operação de criação de clone, mesmo que a recuperação falhe, o clone será criado com um aviso.  Você pode executar a recuperação manual neste clone para trazer o banco de dados clone para um estado consistente.

. Monitore o progresso da operação clicando em *Monitorar* > *Trabalhos*.


*Resultado*

Após clonar o banco de dados, você pode atualizar a página de recursos para listar o banco de dados clonado como um dos recursos disponíveis para backup.  O banco de dados clonado pode ser protegido como qualquer outro banco de dados usando o fluxo de trabalho de backup padrão ou pode ser incluído em um grupo de recursos (recém-criado ou existente).  O banco de dados clonado pode ser clonado posteriormente (clone de clones).

Após a clonagem, você nunca deve renomear o banco de dados clonado.


NOTE: Se você não tiver executado a recuperação durante a clonagem, o backup do banco de dados clonado poderá falhar devido à recuperação inadequada e talvez seja necessário executar a recuperação manual.  O backup de log também pode falhar se o local padrão preenchido para logs de arquivamento estiver em um armazenamento que não seja da NetApp ou se o sistema de armazenamento não estiver configurado com o SnapCenter.

Na configuração do AIX, você pode usar o comando lkdev para bloquear e o comando rendev para renomear os discos nos quais o banco de dados clonado residia.

Bloquear ou renomear dispositivos não afetará a operação de exclusão de clones.  Para layouts AIX LVM criados em dispositivos SAN, a renomeação de dispositivos não será suportada para os dispositivos SAN clonados.

*Encontre mais informações*

* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/ORA-00308%3A_cannot_open_archived_log_ORA_LOG_arch1_123_456789012.arc["A restauração ou clonagem falha com a mensagem de erro ORA-00308"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Failed_to_recover_a_cloned_database["Falha ao recuperar um banco de dados clonado"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/What_are_the_customizable_parameters_for_backup_restore_and_clone_operations_on_AIX_systems["Parâmetros personalizáveis para operações de backup, restauração e clonagem em sistemas AIX"^]




== Atualizar o IP preferencial no host

Após a conclusão da operação de clonagem, o caminho fornecido pela Camada de Acesso ao Armazenamento (SAL) para o clone estará no formato _<nfs_lif_IP>:<JunctionPath>_.  Para fornecer o IP preferencial, você deve configurá-lo no host usando os comandos SCCLI.

.Passos
. Efetue login no host do banco de dados.
. Inicie uma sessão de conexão do PowerShell com o SnapCenter para um usuário especificado.
+
Conexão Sm aberta

. Crie um arquivo vazio.
+
toque em /var/opt/snapcenter/scu/etc/storagepreference.properties

. Configure o LIF de dados preferencial para o SVM.
+
Add-SvmPreferredDataPath -SVM <Nome do SVM> -DataPath <endereço IP ou FQDN>

. Verifique o caminho preferido.
+
Obter-SvmPreferredDataPath


