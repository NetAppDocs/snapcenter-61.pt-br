---
permalink: protect-sce/task_restore_exchange_databases.html 
sidebar: sidebar 
keywords: SnapCenter plug-in for Exchange Server 
summary: Você pode usar o SnapCenter para restaurar bancos de dados do Exchange com backup. 
---
= Restaurar bancos de dados do Exchange
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Você pode usar o SnapCenter para restaurar bancos de dados do Exchange com backup.

.Antes de começar
* Você deve ter feito backup dos grupos de recursos, do banco de dados ou dos Grupos de Disponibilidade de Banco de Dados (DAGs).
* Quando o banco de dados do Exchange é migrado para outro local, a operação de restauração não funciona para backups antigos.
* Se você estiver replicando Snapshots para um espelho ou cofre, o administrador do SnapCenter deverá ter atribuído a você as SVMs para os volumes de origem e de destino.
* Em um DAG, se uma cópia ativa do banco de dados estiver em um armazenamento não NetApp e você quiser restaurar a partir do backup da cópia passiva do banco de dados que está em um armazenamento NetApp , torne a cópia passiva (armazenamento NetApp ) como cópia ativa, atualize os recursos e execute a operação de restauração.
+
Execute o `Move-ActiveMailboxDatabase` comando para fazer a cópia passiva do banco de dados como cópia ativa do banco de dados.

+
O https://docs.microsoft.com/en-us/powershell/module/exchange/move-activemailboxdatabase?view=exchange-ps["Documentação da Microsoft"^] contém informações sobre este comando.



.Sobre esta tarefa
* Quando a operação de restauração é executada em um banco de dados, o banco de dados é montado novamente no mesmo host e nenhum novo volume é criado.
* Os backups em nível de DAG devem ser restaurados de bancos de dados individuais.
* A restauração completa do disco não é suportada quando existem arquivos diferentes do banco de dados do Exchange (.edb).
+
O plug-in para Exchange não executa uma restauração completa em um disco se o disco contiver arquivos do Exchange, como aqueles usados para replicação.  Quando uma restauração completa pode afetar a funcionalidade do Exchange, o Plug-in for Exchange executa uma única operação de restauração de arquivo.

* O plug-in para Exchange não pode restaurar unidades criptografadas pelo BitLocker.
* O SCRIPTS_PATH é definido usando a chave PredefinedWindowsScriptsDirectory localizada no arquivo SMCoreServiceHost.exe.Config do host do plug-in.
+
Se necessário, você pode alterar esse caminho e reiniciar o serviço SMcore.  É recomendável que você use o caminho padrão por segurança.

+
O valor da chave pode ser exibido no swagger por meio da API: API /4.7/configsettings

+
Você pode usar a API GET para exibir o valor da chave.  A API SET não é suportada.

* Para o ONTAP 9.12.1 e versões anteriores, os clones criados a partir dos SnapLock Vault Snapshots como parte da restauração herdarão o tempo de expiração do SnapLock Vault. O administrador de armazenamento deve limpar manualmente os clones após o tempo de expiração do SnapLock .
* Para a operação de restauração de sincronização ativa do SnapMirror , você deve selecionar o backup do local principal.


[role="tabbed-block"]
====
.Interface do usuário do SnapCenter
--
.Passos
. No painel de navegação esquerdo, clique em *Recursos* no canto superior esquerdo da página Recursos.
. Selecione o plug-in do Exchange Server na lista suspensa.
. Na página Recursos, selecione *Banco de dados* na lista Exibir.
. Selecione o banco de dados na lista.
. Na exibição Gerenciar cópias, selecione *Backups*, na tabela Backups primários e clique em *image:../media/restore_icon.gif["ícone de restauração"] *.
. Na página Opções, selecione uma das seguintes opções de backup de log:
+
|===
| Opção | Descrição 


 a| 
Todos os backups de log
 a| 
Selecione *Todos os backups de log* para executar uma operação de restauração de backup atualizada para restaurar todos os backups de log disponíveis após o backup completo.



 a| 
Por backups de log até
 a| 
Escolha *Por backups de log até* para executar uma operação de restauração pontual, que restaura o banco de dados com base em backups de log até o log selecionado.


NOTE: O número de logs exibidos na lista suspensa é baseado em UTM.  Por exemplo, se a retenção de backup completo for 5 e a retenção UTM for 3, o número de backups de log disponíveis será 5, mas no menu suspenso apenas 3 logs serão listados para executar a operação de restauração.



 a| 
Por data específica até
 a| 
Escolha *Por data específica até* para especificar a data e a hora até as quais os logs de transações serão aplicados ao banco de dados restaurado.  Esta operação de restauração pontual restaura entradas de log de transações que foram registradas até o último backup na data e hora especificadas.



 a| 
Nenhum
 a| 
Escolha *Nenhum* quando precisar restaurar apenas o backup completo, sem nenhum backup de log.

|===
+
Você pode executar uma das seguintes ações:

+
** *Recuperar e montar banco de dados após a restauração* - Esta opção é selecionada por padrão.
** *Não verifique a integridade dos logs de transações no backup antes da restauração* - Por padrão, o SnapCenter verifica a integridade dos logs de transações em um backup antes de executar uma operação de restauração.
+
|===


| *Melhores práticas:* Você não deve selecionar esta opção. 
|===


. Na página Script, insira o caminho e os argumentos do prescript ou postscript que devem ser executados antes ou depois da operação de restauração, respectivamente.
+
Os argumentos de prescrição de restauração incluem $Database e $ServerInstance.

+
Os argumentos de restauração do postscript incluem $Database, $ServerInstance, $BackupName, $LogDirectory e $TargetServerInstance.

+
Você pode executar um script para atualizar traps SNMP, automatizar alertas, enviar logs e assim por diante.

+

NOTE: O caminho de prescrições ou pós-escritos não deve incluir unidades ou compartilhamentos.  O caminho deve ser relativo ao SCRIPTS_PATH.

. Na página Notificação, na lista suspensa *Preferência de e-mail*, selecione os cenários nos quais você deseja enviar os e-mails.
+
Você também deve especificar os endereços de e-mail do remetente e do destinatário, e o assunto do e-mail.

. Revise o resumo e clique em *Concluir*.
. Você pode visualizar o status do trabalho de restauração expandindo o painel Atividade na parte inferior da página.
+
Você deve monitorar o processo de restauração usando a página *Monitor* > *Tarefas*.



Ao restaurar um banco de dados ativo a partir de um backup, o banco de dados passivo pode entrar em estado suspenso ou com falha se houver um atraso entre a réplica e o banco de dados ativo.

A mudança de estado pode ocorrer quando a cadeia de logs do banco de dados ativo se bifurca e inicia uma nova ramificação, o que interrompe a replicação.  O Exchange Server tenta corrigir a réplica, mas se não conseguir, após a restauração, você deve criar um novo backup e, em seguida, propagar novamente a réplica.

--
.Cmdlets do PowerShell
--
.Passos
. Inicie uma sessão de conexão com o SnapCenter Server para um usuário especificado usando o `Open-SmConnection` cmdlet.
+
[listing]
----
Open-smconnection  -SMSbaseurl  https://snapctr.demo.netapp.com:8146/
----
. Recupere as informações sobre um ou mais backups que você deseja restaurar usando o `Get-SmBackup` cmdlet.
+
Este exemplo exibe informações sobre todos os backups disponíveis:

+
[listing]
----
PS C:\> Get-SmBackup

BackupId                      BackupName                    BackupTime                    BackupType
--------                      ----------                    ----------                    ----------
341                           ResourceGroup_36304978_UTM... 12/8/2017 4:13:24 PM          Full Backup
342                           ResourceGroup_36304978_UTM... 12/8/2017 4:16:23 PM          Full Backup
355                           ResourceGroup_06140588_UTM... 12/8/2017 6:32:36 PM          Log Backup
356                           ResourceGroup_06140588_UTM... 12/8/2017 6:36:20 PM          Full Backup
----
. Restaurar dados do backup usando o `Restore-SmBackup` cmdlet.
+
Este exemplo restaura um backup atualizado:

+
[listing]
----
C:\PS> Restore-SmBackup -PluginCode SCE -AppObjectId 'sce-w2k12-exch.sceqa.com\sce-w2k12-exch_DB_2' -BackupId 341 -IsRecoverMount:$true
----
+
Este exemplo restaura um backup de um ponto no tempo:

+
[listing]
----
C:\ PS> Restore-SmBackup -PluginCode SCE -AppObjectId 'sce-w2k12-exch.sceqa.com\sce-w2k12-exch_DB_2' -BackupId 341 -IsRecoverMount:$true -LogRestoreType ByTransactionLogs -LogCount 2
----
+
Este exemplo restaura um backup no armazenamento secundário para o histórico primário:

+
[listing]
----
C:\ PS> Restore-SmBackup -PluginCode 'SCE' -AppObjectId 'DB2' -BackupId 81 -IsRecoverMount:$true -Confirm:$false
-archive @{Primary="paw_vs:vol1";Secondary="paw_vs:vol1_mirror"} -logrestoretype All
----
+
O `-archive` O parâmetro permite que você especifique os volumes primário e secundário que deseja usar para a restauração.

+
O `-IsRecoverMount:$true` parâmetro permite que você monte o banco de dados após a restauração.



As informações sobre os parâmetros que podem ser usados com o cmdlet e suas descrições podem ser obtidas executando _Get-Help command_name_. Alternativamente, você também pode consultar o https://docs.netapp.com/us-en/snapcenter-cmdlets/index.html["Guia de referência do cmdlet do software SnapCenter"^] .

--
====